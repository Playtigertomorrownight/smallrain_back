<!DOCTYPE html>
<html>
<head>
  <#include "/common/head.html"/>
  <link rel="stylesheet" type="text/css" href="../static/css/index.css">
  <title>${title}</title>
</head>
 <body>
 <div id="app">
   <div class="layout">
        <Layout>
            <Header>
             <!-- 头部菜单列表 以及 logo-->
                <i-menu mode="horizontal" theme="dark" active-name="menu-manager"  @on-select="clickTopMenu">
                    <div class="layout-logo"></div>
                    <div class="layout-nav">
                    
                        <menu-item v-for="menu in menus.top" :name="menu.id" :class="menu.clazz" :key="menu.id" >
                            <Icon :type="menu.icon"></Icon>
                            {{menu.text}}
                        </menu-item>
                    </div>
                </i-menu>
            </Header>
            <Layout>
                <Sider v-if="hasSider" hide-trigger :style="{background: '#fff'}">
                    <i-menu active-name="manager-back-menu" theme="light" width="auto" :open-names="['']" @on-select="clickLeftMenu">
                        <template v-for="menu in menus.left">
	                        <Submenu v-if="menu.sub&&menu.sub.length"  :name="menu.id">
	                            <template slot="title">
	                                <Icon :type="menu.icon"></Icon>
	                                {{menu.text}}
	                            </template> 
		                            <menu-item v-for="sub in menu.sub" :name="sub.id" :key="sub.id">
		                               {{sub.text}}
		                            </menu-item>
	                        </Submenu>
	                        <menu-item  v-else :name="menu.id" :class="menu.clazz" :key="menu.id" >
	                            <Icon :type="menu.icon"></Icon>
	                            {{menu.text}}
                            </menu-item>
                        </template>
                    </i-menu>
                </Sider>
                <Layout :style="{padding: '0 24px 24px'}">
                  <!--   <Breadcrumb :style="{margin: '24px 0'}">
                        <breadcrumb-item>Home</breadcrumb-item>
                        <breadcrumb-item>Components</breadcrumb-item>
                        <breadcrumb-item>Layout</breadcrumb-item>
                    </Breadcrumb> -->
                    <Content :style="{padding: '24px', minHeight: '580px', background: '#fff'}">
                        <Row>
					        <i-col span="10">
					           <Tree :data="menuTree" :render="renderContent"></Tree>
					        </i-col>
					        <i-col span="14" :style="{padding: '10px 50px'}">
					           <i-form :model="menuFormData" label-position="left" :label-width="200">
		                            <form-item label="Title">
		                                <i-input v-model="menuFormData.input1"></i-input>
		                            </form-item>
		                            <form-item label="Title name">
		                                <i-input v-model="menuFormData.input2"></i-input>
		                            </form-item>
		                            <form-item label="Aligned title">
		                                <i-input v-model="menuFormData.input3"></i-input>
		                            </form-item>
		                        </i-form>
					        </i-col>
					    </Row>
                          
                    </Content>
                </Layout>
            </Layout>
        </Layout>
    </div>
</div>
    
<script type="text/javascript">
new Vue({
    el: '#app',
    data: function(){
    	return {
	        menus: ${menus},
	        title: "smallrain",
	        menuFormData: {
	        	input1: "",
	        	input2: "",
	        	input3: "",
	        	input4: ""
	        },
	        menuTree: [
	            {
	                title: '所有菜单',
	                expand: true,
	                render: (h, { root, node, data }) => {    //根节点渲染器
	                    return h('span', {
	                        style: {display: 'inline-block',width: '100%'}
	                    },[
	                        h('span', [
	                            h('Icon', {
	                                props: {
	                                    type: 'ios-keypad'
	                                },
	                                style: {
	                                    marginRight: '8px'
	                                }
	                            }),
	                            h('span', data.title)
	                        ]),
	                        h('span', {
	                            style: {
	                                display: 'inline-block',
	                                float: 'right',
	                                marginRight: '32px'
	                            }
	                        }, [
	                            h('Button', {
	                                props: Object.assign({}, this.buttonProps, {
	                                    icon: 'ios-add',
	                                    type: 'primary'
	                                }),
	                                style: {
	                                    width: '64px',
	                                },
	                                on: {
	                                    click: () => { this.append(data) }
	                                }
	                            })
	                        ])
	                    ]);
	                },
	                children: [
	                    {
	                        title: 'child 1-1',
	                        expand: true,
	                        children: [
	                            {
	                                title: 'leaf 1-1-1',
	                                expand: true
	                            },
	                            {
	                                title: 'leaf 1-1-2',
	                                expand: true
	                            }
	                        ]
	                    },
	                    {
	                        title: 'child 1-2',
	                        expand: true,
	                        children: [
	                            {
	                                title: 'leaf 1-2-1',
	                                expand: true
	                            },
	                            {
	                                title: 'leaf 1-2-1',
	                                expand: true
	                            }
	                        ]
	                    }
	                ]
	            }
	        ],
	        buttonProps: {
	            type: 'default',
	            size: 'small',
	        }
	    }
    },
    computed: {
    	hasSider: function (){
    		return this.menus.left&&this.menus.left.length;
    	}
    },
    methods: {
    	clickTopMenu: function(name){
    		let href =  this.getUrl("top",name);
    		console.info("点击了头部按钮,"+name+" 跳转到页面："+ href);
    		if(document.location == href) return;
    		window.location.href = href;
    	},
    	clickLeftMenu: function(name){
    		let href =  this.getUrl("left",name);
    		console.info("点击了左部按钮："+name+" 跳转到页面："+ href);
    		if(document.location == href) return;
    		window.location.href = href;
    	},
    	getUrl: function(filed,name){
    		var menus = filed=="top"?this.menus.top:this.menus.left;
    		if(menus && menus.length){
    			for ( let i = 0; i < menus.length; i++){
    				let menu = menus[i];
    			    if(menu.id == name){
    			    	return getAimUrl(menu.url);
    			    }
    			    if(menu.sub && menu.sub.length){
    			    	for ( let j = 0; j < menu.sub.length; j++){
    			    		let sub = menu.sub[j];
    	                    if(sub.id == name){
    	                        return getAimUrl(sub.url);
    	                    }
    			    	}
    			    }
    			}
    		}
    		return document.location;
    	},
    	renderContent: function(h, { root, node, data }) {   //树结构子元素渲染器
            return h('span', {
                style: {
                    display: 'inline-block',
                    width: '100%'
                }
            }, [
                h('span', [
                    h('Icon', {
                        props: {
                            type: 'ios-menu'
                        },
                        style: {
                            marginRight: '8px'
                        }
                    }),
                    h('span', data.title)
                ]),
                h('span', {
                    style: {
                        display: 'inline-block',
                        float: 'right',
                        marginRight: '32px'
                    }
                }, [
                    h('Button', {
                        props: Object.assign({}, this.buttonProps, {
                            icon: 'ios-add'
                        }),
                        style: {
                            marginRight: '8px'
                        },
                        on: {
                            click: () => { this.append(data) }
                        }
                    }),
                    h('Button', {
                        props: Object.assign({}, this.buttonProps, {
                            icon: 'ios-remove'
                        }),
                        on: {
                            click: () => { this.remove(root, node, data) }
                        }
                    })
                ])
            ]);
        },
        append: function(data) {
            const children = data.children || [];
            children.push({
                title: 'appended node',
                expand: true
            });
            this.$set(data, 'children', children);
        },
        remove: function(root, node, data) {
            const parentKey = root.find(el => el === node).parent;
            const parent = root.find(el => el.nodeKey === parentKey).node;
            const index = parent.children.indexOf(data);
            parent.children.splice(index, 1);
        }
    },
    watch: {
    	
    }
    
})
</script>
    
</body>
</html>
